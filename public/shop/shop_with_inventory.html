<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EETAC BROS - Tienda</title>

    <!-- NES.css for retro gaming style -->
    <link href="https://unpkg.com/nes.css@2.3.0/css/nes.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #5c94fc;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .pixel-bg {
            background-image:
                    linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent),
                    linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
            background-size: 50px 50px;
        }

        .cloud-1, .cloud-2 {
            position: fixed;
            width: 100px;
            height: 50px;
            background: white;
            border-radius: 50px;
            opacity: 0.8;
            animation: float 20s infinite;
        }

        .cloud-1 { top: 50px; left: 10%; }
        .cloud-2 { top: 150px; right: 15%; animation-delay: -10s; }

        @keyframes float {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(30px); }
        }

        .header {
            text-align: center;
            color: white;
            text-shadow: 4px 4px 0px #000;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2em;
            margin: 0;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .inventory-section {
            flex: 0 0 350px;
            background: white;
            border: 4px solid #000;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
            max-height: 600px;
            overflow-y: auto;
        }

        .inventory-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #000;
        }

        .inventory-header h2 {
            font-size: 1em;
            margin: 0;
        }

        .inventory-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .inventory-item {
            background: #f7f7f7;
            border: 3px solid #000;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.2s;
        }

        .inventory-item:hover {
            transform: translateX(5px);
            background: #fff3cd;
        }

        .inventory-item-emoji {
            font-size: 2em;
            min-width: 40px;
            text-align: center;
        }

        .inventory-item-details {
            flex: 1;
        }

        .inventory-item-name {
            font-size: 0.8em;
            margin-bottom: 5px;
            color: #212529;
        }

        .inventory-item-description {
            font-size: 0.5em;
            color: #666;
            margin-bottom: 8px;
        }

        .inventory-item-stats {
            display: flex;
            gap: 10px;
            font-size: 0.6em;
        }

        .inventory-stat {
            background: #209cee;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            border: 2px solid #000;
        }

        .inventory-empty {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-size: 0.7em;
        }

        .shop-section {
            flex: 1;
            min-width: 0;
        }

        .shop-container {
            background: white;
            border: 4px solid #000;
            border-radius: 8px;
            padding: 20px;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .coins-display {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2em;
            color: #f7d51d;
            text-shadow: 2px 2px 0px #000;
        }

        .coin-icon {
            font-size: 1.5em;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .cart-icon {
            position: relative;
            font-size: 2em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .cart-icon:hover {
            transform: scale(1.1);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -10px;
            background: #e76e55;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5em;
            border: 2px solid #000;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .cart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .cart-modal.active {
            display: flex;
        }

        .cart-content {
            background: white;
            border: 4px solid #000;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #000;
        }

        .cart-items {
            margin-bottom: 20px;
        }

        .cart-total {
            font-size: 1.2em;
            text-align: right;
            padding: 15px;
            background: #f7d51d;
            border: 3px solid #000;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .cart-actions {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }

        .button-icon {
            margin-right: 10px;
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }

            .inventory-section {
                flex: 1;
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.2em;
            }

            .products-grid {
                grid-template-columns: 1fr;
            }

            .inventory-item {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body class="pixel-bg">
<!-- Decorative elements -->
<div class="cloud-1"></div>
<div class="cloud-2"></div>

<div class="header">
    <h1>üõí EETAC BROS SHOP üõí</h1>
    <p>¬°Buy items for your adventure!</p>
</div>

<div class="main-container">
    <!-- Inventory Section (Left) -->
    <div class="inventory-section">
        <div class="inventory-header">
            <span style="font-size: 1.5em;">üéí</span>
            <h2>My Inventory</h2>
        </div>
        <div class="inventory-items" id="inventoryItems">
            <div class="inventory-empty">
                <p>Loading inventory...</p>
            </div>
        </div>
    </div>

    <!-- Shop Section (Right) -->
    <div class="shop-section">
        <div class="shop-container">
            <div class="shop-header">
                <div class="coins-display">
                    <span class="coin-icon">ü™ô</span>
                    <span id="coins">0</span> coins
                </div>
                <div class="cart-icon" id="cartIcon">
                    üõí
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <button class="nes-btn is-error" id="logoutBtn">Log Out</button>
            </div>

            <div class="products-grid" id="productsGrid">
                <!-- Los productos se cargar√°n aqu√≠ con JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Modal del carrito -->
<div class="cart-modal" id="cartModal">
    <div class="cart-content">
        <div class="cart-header">
            <h2>üõí Your Cart</h2>
            <button class="nes-btn is-error" id="closeCart">X</button>
        </div>

        <div class="cart-items" id="cartItems">
            <!-- Los items del carrito se cargar√°n aqu√≠ -->
        </div>

        <div class="cart-total">
            <span>Total:</span>
            <span id="cartTotal">0</span> coins
        </div>
        <div class="cart-actions">
            <button class="nes-btn is-warning" id="clearCart">
                <span class="button-icon">üóëÔ∏è</span>
                Empty Cart
            </button>
            <button class="nes-btn is-success" id="checkoutBtn">
                <span class="button-icon">üí≥</span>
                Buy
            </button>
        </div>
    </div>
</div>

<script>
    // Function to load user's purchased items
    async function loadUserInventory(userId) {
        try {
            const response = await fetch(`http://localhost:8080/example/eetacbros/user/items/${userId}`);

            if (!response.ok) {
                throw new Error('Failed to fetch inventory');
            }

            const items = await response.json();
            displayInventory(items);
        } catch (error) {
            console.error('Error loading inventory:', error);
            document.getElementById('inventoryItems').innerHTML = `
                <div class="inventory-empty">
                    <p>‚ùå Error loading inventory</p>
                    <p style="font-size: 0.6em; margin-top: 10px;">Could not connect to server</p>
                </div>
            `;
        }
    }

    // Function to display inventory items
    function displayInventory(items) {
        const inventoryContainer = document.getElementById('inventoryItems');

        if (!items || items.length === 0) {
            inventoryContainer.innerHTML = `
                <div class="inventory-empty">
                    <p>üì¶ No items yet</p>
                    <p style="font-size: 0.6em; margin-top: 10px;">Purchase items from the shop!</p>
                </div>
            `;
            return;
        }

        inventoryContainer.innerHTML = items.map(item => `
            <div class="inventory-item">
                <div class="inventory-item-emoji">${item.emoji || 'üì¶'}</div>
                <div class="inventory-item-details">
                    <div class="inventory-item-name">${item.name}</div>
                    <div class="inventory-item-description">${item.description || 'No description'}</div>
                    <div class="inventory-item-stats">
                        <span class="inventory-stat">‚ö° ${item.durability || 0}</span>
                        <span class="inventory-stat">√ó ${item.quantity || 1}</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    // Initialize - Replace 'YOUR_USER_ID' with actual user ID from your authentication system
    $(document).ready(function() {
        // Get userId from your authentication system or localStorage
        const userId = localStorage.getItem('userId') || '1'; // Default to '1' for testing

        // Load inventory
        loadUserInventory(userId);

        // Reload inventory after successful purchase
        $('#checkoutBtn').on('click', function() {
            // Your existing checkout logic here
            // After successful purchase, reload inventory:
            setTimeout(() => {
                loadUserInventory(userId);
            }, 1000);
        });
    });

    // Your existing shop JavaScript code goes here
    // (base.js and shop/index.js functionality)
</script>

<script src="base.js"></script>
<script src="shop/index.js"></script>
</body>
</html>